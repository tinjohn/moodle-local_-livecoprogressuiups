define("local_livecoprogressuiups/dynprogress",["exports","./listener","./local/dynprogress/repository","local_livecoprogressuiups/local/dynprogress/selectors"],(function(_exports,_listener,_repository,_selectors){var obj;
/**
   * Dynamic Progressbar and more
   *
   * @module     local_livecoprogressuiups/dynprbar
   * @copyright  2023 Tina John <tina.john@th-luebeck.de>
   * @copyright  Institut fuer interaktive Systeme der TH LÃ¼beck
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function getCourseIdFromBody(){const bodyTag=document.getElementsByTagName("body")[0];var courseid;return bodyTag.getAttributeNames().forEach((attribute=>{const matches=bodyTag.getAttribute(attribute).match(/course-(\d+)/);if(matches){const courseNumber=matches[0];return courseid=courseNumber.split("-")[1],window.console.log("lcprogessuiups-- Coursenumber------",courseid),courseid}})),courseid||!1}function modifyDOM(aselector){return function(innerHTML){const elementToReplace=document.getElementsByClassName(aselector)[0];if(elementToReplace){window.console.log("---modifyDOM--",aselector);const newElement=document.createElement("div");newElement.innerHTML=innerHTML;elementToReplace.parentNode.replaceChild(newElement,elementToReplace)}}}async function promise_get_InnerHTM(getinnerhtmlfunc,course_id){return new Promise((async(resolve,reject)=>{try{const response=await getinnerhtmlfunc(course_id);response&&response.innerHTML?resolve(response.innerHTML):reject(response)}catch(error){reject(error)}}))}function onError(err){window.console.log("--ERROR: ",err)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.letthemagicbedone=_exports.initWORKING=_exports.init=_exports.changeProgressbarWORKS=_exports.changeProgressbarPROMISE_PARAMS_WORKS=_exports.changeProgressbarPROMISEWORKS=_exports.changeProgressbar=_exports.changeGAME=void 0,_selectors=(obj=_selectors)&&obj.__esModule?obj:{default:obj};const changeProgressbar=()=>{const course_id=getCourseIdFromBody();course_id&&promise_get_InnerHTM(_repository.get_theme_learnr_Progressbar_InnerHTML,course_id).then(modifyDOM(_selectors.default.progressbar.body)).catch(onError)};_exports.changeProgressbar=changeProgressbar;const letthemagicbedone=(course_id,servicefunc,selector)=>{promise_get_InnerHTM(servicefunc,course_id).then(modifyDOM(selector)).catch(onError)};_exports.letthemagicbedone=letthemagicbedone;_exports.changeProgressbarPROMISE_PARAMS_WORKS=()=>{const course_id=getCourseIdFromBody();course_id&&promise_get_InnerHTM(_repository.get_theme_learnr_Progressbar_InnerHTML,course_id).then(modifyDOM).catch(onError)};_exports.changeProgressbarPROMISEWORKS=()=>{const course_id=getCourseIdFromBody();course_id&&async function(course_id){return new Promise((async(resolve,reject)=>{try{const response=await(0,_repository.get_theme_learnr_Progressbar_InnerHTML)(course_id);response&&response.innerHTML?resolve(response.innerHTML):reject(response)}catch(error){reject(error)}}))}(course_id).then(modifyDOM).catch(onError)};_exports.changeProgressbarWORKS=async()=>{const course_id=getCourseIdFromBody();if(course_id){var response=await(0,_repository.get_theme_learnr_Progressbar_InnerHTML)(course_id);if(response&&response.innerHTML){window.console.log("lcprogessuiups-- get_theme_learnr_Progressbar_InnerHTML----response",response);var innerHTML=response.innerHTML;var elementToReplace=document.getElementsByClassName(_selectors.default.progressbar.body)[0];const newElement=document.createElement("div");newElement.innerHTML=innerHTML;elementToReplace.parentNode.replaceChild(newElement,elementToReplace)}else window.console.log("lcprogessuiups-- no progressbar update available");return!0}return window.console.log("lcprogessuiups-- no course id detected"),!1};const changeGAME=async()=>{const course_id=getCourseIdFromBody();if(course_id){var response=await(0,_repository.get_block_Game_InnerHTML)(course_id);if(response&&response.innerHTML){window.console.log("lcprogessuiups-- get_block_Game_InnerHTML----response",response);var innerHTML=response.innerHTML;const elementToReplaceGAME=document.getElementsByClassName(_selectors.default.game.body)[0].parentNode,newElementGAME=document.createElement("div");newElementGAME.innerHTML=innerHTML;elementToReplaceGAME.parentNode.replaceChild(newElementGAME,elementToReplaceGAME)}else window.console.log("lcprogessuiups-- no game update possible"),window.console.log("lcprogessuiups-- get_block_Game_InnerHTML----response",response);return!0}return window.console.log("lcprogessuiups-- no course id detected"),!1};_exports.changeGAME=changeGAME;const dynprbar_action=changeProgressbar,game_action=changeGAME,complinfo_action=async event=>{if(window.console.log("lcprogessuiups-- --changeCompletionInfo--event",event),event&&event.detail)if(event.detail.completionType&&"H5Pscored"==event.detail.completionType)if(event.detail.framedin){const eventtarget=event.detail.framedin;window.console.log("lcprogessuiups-- eventtarget",eventtarget);var element=eventtarget.closest("li > div");const cmid=(liidelement=>{var courseid;const matches=liidelement.getAttribute("id").match(/module-(\d+)/);if(matches)return courseid=matches[0].split("-")[1],window.console.log("lcprogessuiups-- cmid------",courseid),courseid})(eventtarget.closest("li")),course_id=getCourseIdFromBody(),response=await(0,_repository.get_H5P_ActivityInformation_InnerHTML)(course_id,cmid);window.console.log("lcprogessuiups-- get_H5P_ActivityInformation_InnerHTML----response",response),(element=element.querySelector(_selectors.default.activityinfo.body)).innerHTML=response.innerHTML}else window.console.log("lcprogessuiups-- no DOM for ActivityInformation in event");else window.console.log("lcprogessuiups-- no H5Pscored completionType in event");return!0};_exports.init=()=>{var prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0];const course_id=getCourseIdFromBody();window.console.log("lcprogessuiups-- prbarneusrc"+prbar),prbar&&course_id?(window.console.log("lcprogessuiups-- livecoprogressuiups----load listener"),(0,_listener.init)()):window.console.log("lcprogessuiups-- livecoprogressuiups----no listeners loaded due to missing prbar"),window.addEventListener("load",(function(){var prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0];window.console.log("lcprogessuiups-- prbarneusrc"+prbar),document.addEventListener("cmcompleted",(function(event){window.console.log("lcprogessuiups-- cmcompleted----Custom event triggered:",event.detail.message),setTimeout((function(){letthemagicbedone(course_id,_repository.get_theme_learnr_Progressbar_InnerHTML,_selectors.default.progressbar.body),complinfo_action(event),letthemagicbedone(course_id,_repository.get_block_Game_InnerHTML,_selectors.default.game.body)}),300)}))}))};_exports.initWORKING=()=>{var prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0];window.console.log("lcprogessuiups-- prbarneusrc"+prbar),prbar?(window.console.log("lcprogessuiups-- livecoprogressuiups----load listener"),(0,_listener.init)()):window.console.log("lcprogessuiups-- livecoprogressuiups----no listeners loaded due to missing prbar"),window.addEventListener("load",(function(){var prbar=document.getElementsByClassName("progress-bar progress-bar-info")[0];window.console.log("lcprogessuiups-- prbarneusrc"+prbar),document.addEventListener("cmcompleted",(function(event){window.console.log("lcprogessuiups-- cmcompleted----Custom event triggered:",event.detail.message),setTimeout((function(){dynprbar_action(),complinfo_action(event),game_action()}),300)}))}))}}));

//# sourceMappingURL=dynprogress.min.js.map