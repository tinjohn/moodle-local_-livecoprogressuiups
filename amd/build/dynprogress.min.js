define("local_livecoprogressuiups/dynprogress",["exports","./listener","./local/dynprogress/repository","local_livecoprogressuiups/local/dynprogress/selectors"],(function(_exports,_listener,_repository,_selectors){var obj;
/**
   * Dynamic Progressbar and more
   *
   * @module     local_livecoprogressuiups/dynprogress
   * @copyright  2023 Tina John <tina.john@th-luebeck.de>
   * @copyright  Institut fuer interaktive Systeme der TH LÃ¼beck
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function replaceDOM(selectorclass){let element=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return async function(innerHTML){const elementToReplace=element.getElementsByClassName(selectorclass)[0];if(elementToReplace){const newElement=document.createElement("div");newElement.innerHTML=innerHTML;elementToReplace.parentNode.replaceChild(newElement,elementToReplace)}}}function modifyDOM(selectorq){let element=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return async function(innerHTML){element.querySelector(selectorq).innerHTML=innerHTML}}async function get_InnerHTML(getinnerhtmlfunc,course_id){let options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let response;if(response=options.cmid?await getinnerhtmlfunc(course_id,options.cmid):await getinnerhtmlfunc(course_id),response&&response.innerHTML)return response.innerHTML;throw"in Webservice - no response.innerHTML found."}catch(error){throw"".concat(error," in Webservice: - servicefunc: ").concat(getinnerhtmlfunc,", \n        error - get_InnerHTML: , coursid: ").concat(course_id," , ").concat(options.cmid)}}function onError(err){window.console.log("--ERROR ",err)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.letthemagicbedone=_exports.init=void 0,_selectors=(obj=_selectors)&&obj.__esModule?obj:{default:obj};const letthemagicbedone=async(course_id,servicefunc,selector)=>{if(!document.getElementsByClassName(selector)[0])return!0;try{const innerHTML=await get_InnerHTML(servicefunc,course_id);await replaceDOM(selector)(innerHTML)}catch(error){onError("Something went wrong rewriting a DOM Element - servicefunc: ".concat(servicefunc,", error: ").concat(error))}};_exports.letthemagicbedone=letthemagicbedone;const getCmid=liidelement=>{const matches=liidelement.getAttribute("id").match(/module-(\d+)/);if(matches){return matches[0].split("-")[1]}},trigger_pseudolabel_mancompl=selectorq=>{const domthere=window.document.querySelector(selectorq);if(!domthere)return window.console.log("pseudolabel_activity - DOM not found"+selectorq),!0;window.console.log("pseudolabel_activity - DOM found");const mancomplbutt=domthere.querySelector(_selectors.default.pseudolabelsmancomplbutt.qselector);if(!mancomplbutt)return window.console.log("pseudolabel_activity - DOM not found"+selectorq),!0;window.console.log("pseudolabel_activity - DOM found"+_selectors.default.pseudolabelsmancomplbutt.qselector),mancomplbutt.click()};_exports.init=()=>{const prbar1=document.getElementsByClassName("progress-bar progress-bar-info")[0],prbar2=document.getElementsByClassName("progressbar")[0],course_id=function(){const bodyTag=document.getElementsByTagName("body")[0];var courseid;return bodyTag.getAttributeNames().forEach((attribute=>{const matches=bodyTag.getAttribute(attribute).match(/course-(\d+)/);if(matches){const courseNumber=matches[0];return courseid=courseNumber.split("-")[1]}})),courseid||!1}();(prbar1||prbar2)&&course_id&&((0,_listener.init)(),window.console.log("lcprogessuiups-- livecoprogressuiups----load listener")),window.addEventListener("load",(function(){document.addEventListener("cmcompleted",(function(event){setTimeout((function(){letthemagicbedone(course_id,_repository.get_theme_learnr_Progressbar_InnerHTML,_selectors.default.progressbar.class),(async(course_id,event)=>{if(event&&event.detail&&event.detail.completionType&&"H5Pscored"==event.detail.completionType&&event.detail.framedin){const eventtarget=event.detail.framedin;var element=eventtarget.closest("li > div");const cmid=getCmid(eventtarget.closest("li"));try{const innerHTML=await get_InnerHTML(_repository.get_H5P_ActivityInformation_InnerHTML,course_id,{cmid:cmid});await modifyDOM(_selectors.default.activityinfo.qselector,element)(innerHTML)}catch(error){onError(error)}}})(course_id,event),letthemagicbedone(course_id,_repository.get_block_Game_InnerHTML,_selectors.default.game.class),(async(course_id,servicefunc,selector)=>{const domthere=document.getElementsByClassName(selector)[0];if(!domthere)return!0;const cmid=getCmid(domthere);try{const innerHTML=await get_InnerHTML(servicefunc,course_id,{cmid:cmid});await replaceDOM(selector)(innerHTML)}catch(error){onError(error)}})(course_id,_repository.get_customcert_Activity_InnerHTML,_selectors.default.customcertactivity.class),(async(course_id,servicefunc,selectorq)=>{const domthere=window.document.querySelector(selectorq);if(!domthere)return!0;const cmid=getCmid(domthere.closest("li"));try{const innerHTML=await get_InnerHTML(servicefunc,course_id,{cmid:cmid});await modifyDOM(selectorq)(innerHTML)}catch(error){onError(error)}trigger_pseudolabel_mancompl(_selectors.default.pseudolabel.qselector)})(course_id,_repository.get_customcert_Activity_InnerHTML,_selectors.default.pseudolabel.qselector),(async(course_id,event)=>{if(event&&event.detail&&event.detail.completionType&&"H5Pscored"==event.detail.completionType&&event.detail.framedin){const eventtarget=event.detail.framedin,cmid=getCmid(eventtarget.closest("li"));try{const innerHTML=await get_InnerHTML(_repository.get_format_mooin4_Progressbar_InnerHTML,course_id,{cmid:cmid}),sectionProgress=innerHTML.progress,sectionId=innerHTML.sectionId,barselector="mooin4ection"+sectionId,bartextselector="mooin4ection-text-"+sectionId,elementTomodbar=document.getElementById(barselector),elementTomodtext=document.getElementById(bartextselector);elementTomodbar?(elementTomodbar.style.width=sectionProgress+"%",elementTomodtext.innerHTML=sectionProgress+"% "):window.console.log("Element with id mooin4ection not found.")}catch(error){onError(error)}}})(course_id,event)}),300)}))}))}}));

//# sourceMappingURL=dynprogress.min.js.map